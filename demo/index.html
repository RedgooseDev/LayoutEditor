<!doctype html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="user-scalable=yes, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<title>Photo layout editor program</title>
<link rel="stylesheet" href="../dist/css/vendor.pkgd.css"/>
<link rel="stylesheet" href="../dist/css/app.pkgd.css"/>
<script>function log(o){console.log(o);}</script>
</head>
<body>
<main class="ple-editor" id="app">
	<!-- Header -->
	<header class="ple-header">
		<h1>Photo Layout Editor</h1>
		<p>사진 레이아웃 에디터입니다. 처음 시작하면 먼저 문서설정을 해주세요!</p>
	</header>
	<!-- // Header -->

	<div class="container">
		<!-- PLE container -->
		<div id="ple_app"></div>
		<!-- // PLE container -->
		<nav class="ple-nav-bottom">
			<p>
				<button type="button" title="Export json" data-action="printJson"><span>Export</span></button>
				<button type="button" title="Export json(packed)" data-action="printJsonPacked"><span>Export(packed)</span></button>
				<button type="button" title="Image" data-action="printImage"><span>Make Image</span></button>
				<button type="button" title="Console" data-action="console"><span>Print console.log</span></button>
			</p>
			<p>
				<button type="button" title="Replace example" data-action="replaceExample"><span>Replace example</span></button>
			</p>
		</nav>
	</div>

	<!-- PLE Sidebar -->
	<div id="ple_side"></div>
	<!-- // PLE Sidebar -->
</main>
<div id="cropper"></div>
<div id="result"></div>
<script src="../dist/js/vendor.pkgd.js"></script>
<script src="../dist/js/app.pkgd.js"></script>
<script>
PLE.init({
	elements : {
		app : document.getElementById('app'),
		container : document.getElementById('ple_app'),
		side : document.getElementById('ple_side'),
		cropper : document.getElementById('cropper'),
		result : document.getElementById('result')
	},
	preference : {
		uploadScript : './script/imageUpload.php',
		removeScript : './script/imageRemove.php',
		defaultImagesScript : './script/defaultImages.php',
		showSide : (localStorage.getItem('sidebar') != 'false'),
		gridster : {
			nameID : 'gridster',
			createNow : true,
			createCount : 4,
			blockColor : '#DDDDDD'
		},
		setting : {
			width : 100,
			height : 100,
			max_col : 5,
			max_scale : 2,
			outer_margin : 10,
			inner_margin : 10
		}
	}
});


jQuery(function($){
	// bottom controller
	$('.ple-nav-bottom button').on('click', function(){
		switch($(this).data('action'))
		{
			case 'printJson':
				PLE.api.gridster.export(null, function(res){
					var result = {
						gridster : res,
						preference : PLE.api.gridster.exportPreference()
					};
					PLE.result.open(
						PLE.export.objectToJson(result, 4),
						'code',
						'json데이터로 만들어서 출력합니다. 이미지 경로는 서버에 저장된 위치로 지정됩니다.'
					);
				});
				break;

			case 'printJsonPacked':
				PLE.api.gridster.export({ type: 'image/jpeg', quality : 0.75 }, function(res){
					var result = {
						gridster : res,
						preference : PLE.api.gridster.exportPreference()
					};
					PLE.result.open(
						PLE.export.objectToJson(result, 0),
						'code',
						'json 데이터로 만들어서 출력합니다.<br>이미지를 base64데이터로 변환하여 json데이터에 같이 들어갑니다.'
					);
				});
				break;

			case 'printImage':
				PLE.api.gridster.makeImage({ type: 'image/jpeg', quality: 0.8, bgColor: '#ffffff' }, function(res){
					PLE.result.open(
						res,
						'image',
						'데이터를 토대로 이미지 형식으로 결과물을 만들었습니다. 이미지 저장을 할 수 있습니다.'
					);
				});
				break;

			case 'console':
				PLE.api.gridster.export(null, function(res){
					console.log({
						gridster : res,
						preference : PLE.api.gridster.exportPreference()
					});
				});
				break;

			case 'replaceExample':
				$.getJSON('./assets/example.json', function(res) {
					if (res.preference)
					{
						PLE.api.gridster.importPreference(res.preference);
					}
					log(res);

					if (res.gridster)
					{
						// replace gridster blocks
						if (res.gridster.params)
						{
							PLE.api.gridster.reset(false);
							PLE.api.gridster.importParams(res.gridster.params);
						}
					}

					if (res.gridster.figure && res.gridster.figure.length)
					{
						var newImages = res.gridster.figure.map(function(o){
							return o.image;
						});
						PLE.api.gridster.attachImages(newImages);
					}

					// TODO : 사이드에 이미지를 등록하기. 아마 기존 이미지 전부 삭제하고 등록해야하지 않을까 싶음.
				});
				break;
		}
	});
});


// TODO : 아래 주석된 api호출 예제코드들을 도큐먼트를 작성하는데 사용하기.

//var api = window.PLE.api;
//document.getElementById('fooo').addEventListener('click', function(e){
//	// $('#gridster li').eq(0)
//
//	// 이미지를 경로 그대로 가져온다
//	//	api.gridster.export(null, function(res){
//	//		log(res);
//	//	});
//
//	// 이미지를 base64코드로 변환하여 가져온다.
//	//	api.gridster.export({
//	//		type: 'image/jpeg',
//	//		quality : 0.5
//	//	}, function(res){
//	//		log(res);
//	//	});
//
//	// 모두 모아져 있는 이미지 만들기
//	//	api.gridster.makeImage({
//	//		type : 'image/jpeg',
//	//		quality : 0.5,
//	//		bgColor : '#ff0000'
//	//	}, function(res){
//	//		log(res);
//	//	});
//
//	//	api.gridster.makeImage({ type: 'image/png', quality: 0.1, bgColor: '#7e04f2' }, function(res){
//	//		$('body').append('<img src="' + res + '" />');
//	//	});
//
//	//	api.gridster.assignImage(
//	//		$('#gridster').find('li:nth-child(1), li:nth-child(3)'),
//	//		'./images/rg3144.jpg',
//	//		{
//	//			size: '80px auto',
//	//			position: '-20px -10px'
//	//		}
//	//	);
//
//	// api.side.attach([1,8]);
//
//	// api.side.remove([1,2]);
//
//	// api.side.select([0,2,3]);
//
//	//api.side.unSelect([1,2,4]);
//
//	//api.side.toggleSelectAll();
//
//	// log(api.side.export());
//});
//document.getElementById('fooo2').addEventListener('click', function(e){
//	api.gridster.unSelect($('#gridster li').eq(2));
//});
</script>
</body>
</html>